<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="theme-color" content="#0b3a1e">
  <link rel="manifest" href="./public/manifest.json">
  <link rel="icon" href="./public/icons/favicon.ico">
  <link rel="icon" sizes="16x16" href="./public/icons/favicon-16x16.webp" type="image/webp">
  <link rel="icon" sizes="32x32" href="./public/icons/favicon-32x32.webp" type="image/webp">
  <link rel="icon" sizes="192x192" href="./public/icons/android-chrome-192x192.webp" type="image/webp">
  <link rel="apple-touch-icon" sizes="180x180" href="./public/icons/apple-touch-icon.webp">
  <link rel="apple-touch-icon" href="./public/icons/android-chrome-512x512.webp">
  <title>AgroEnglish Pro</title>
  <!-- Google Fonts: Poppins para títulos, Inter para corpo (já carregado via sistema) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700;800&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./src/styles/styles.css">
  <script src="https://cdn.tailwindcss.com"></script>
  <meta name="description" content="PWA para inglês técnico rural: agricultura, pecuária, veterinária, máquinas e rotinas de fazenda.">
</head>
<body>
  <a href="#app" class="skip-link">Pular para conteúdo</a>
  <div id="app"></div>
  <div id="auth-gate" style="position:fixed;inset:0;background:rgba(250,250,250,0.98);backdrop-filter:blur(10px);z-index:9999;display:none;align-items:center;justify-content:center;padding:16px">
    <div style="max-width:520px;width:100%;margin:0 auto">
      <div style="font-size:24px;font-weight:700;margin-bottom:16px;font-family:'Poppins',sans-serif;color:#1a1a1a">Autenticação</div>
      <div style="background:#fff;border-radius:16px;box-shadow:0 10px 25px rgba(0,0,0,0.1);padding:24px;border:1px solid #e5e5e5">
        <div style="display:flex;gap:8px;margin-bottom:20px">
          <button id="gate-tab-login" class="ae-btn" style="flex:1;padding:12px 16px;border:2px solid #e5e5e5;border-radius:12px;background:#f5f5f5;color:#1a1a1a;font-weight:600;min-height:44px;transition:all 0.2s ease">Login</button>
          <button id="gate-tab-register" class="ae-btn" style="flex:1;padding:12px 16px;border:2px solid #e5e5e5;border-radius:12px;background:#fff;color:#1a1a1a;font-weight:600;min-height:44px;transition:all 0.2s ease">Cadastro</button>
        </div>
        <div id="gate-login" style="display:block">
          <label style="display:block;font-weight:600;margin-bottom:8px;color:#1a1a1a;font-size:14px">E-mail</label>
          <input id="gate-login-email" type="email" class="ae-input" placeholder="seu@email.com" style="width:100%;margin:0 0 16px 0;border:2px solid #e5e5e5;border-radius:12px;padding:12px 16px;font-size:16px;min-height:44px;transition:all 0.2s ease">
          <label style="display:block;font-weight:600;margin-bottom:8px;color:#1a1a1a;font-size:14px">Senha</label>
          <input id="gate-login-password" type="password" class="ae-input" placeholder="••••••••" style="width:100%;margin:0 0 20px 0;border:2px solid #e5e5e5;border-radius:12px;padding:12px 16px;font-size:16px;min-height:44px;transition:all 0.2s ease">
          <button id="gate-login-submit" class="ae-btn ae-btn-primary" style="width:100%;padding:14px;border-radius:12px;background:linear-gradient(135deg,#0a7f42,#085232);color:#fff;font-weight:700;min-height:44px;box-shadow:0 4px 6px rgba(0,0,0,0.1);transition:all 0.2s ease">Entrar</button>
          <div id="gate-login-msg" style="margin-top:12px;font-size:14px;color:#dc2626;font-weight:500"></div>
        </div>
        <div id="gate-register" style="display:none">
          <label style="display:block;font-weight:600;margin-bottom:8px;color:#1a1a1a;font-size:14px">Nome</label>
          <input id="gate-register-name" type="text" class="ae-input" placeholder="Seu nome" style="width:100%;margin:0 0 16px 0;border:2px solid #e5e5e5;border-radius:12px;padding:12px 16px;font-size:16px;min-height:44px;transition:all 0.2s ease">
          <label style="display:block;font-weight:600;margin-bottom:8px;color:#1a1a1a;font-size:14px">E-mail</label>
          <input id="gate-register-email" type="email" class="ae-input" placeholder="seu@email.com" style="width:100%;margin:0 0 16px 0;border:2px solid #e5e5e5;border-radius:12px;padding:12px 16px;font-size:16px;min-height:44px;transition:all 0.2s ease">
          <label style="display:block;font-weight:600;margin-bottom:8px;color:#1a1a1a;font-size:14px">Senha</label>
          <input id="gate-register-password" type="password" class="ae-input" placeholder="Crie uma senha" style="width:100%;margin:0 0 20px 0;border:2px solid #e5e5e5;border-radius:12px;padding:12px 16px;font-size:16px;min-height:44px;transition:all 0.2s ease">
          <button id="gate-register-submit" class="ae-btn ae-btn-primary" style="width:100%;padding:14px;border-radius:12px;background:linear-gradient(135deg,#0a7f42,#085232);color:#fff;font-weight:700;min-height:44px;box-shadow:0 4px 6px rgba(0,0,0,0.1);transition:all 0.2s ease">Criar conta</button>
          <div id="gate-register-msg" style="margin-top:12px;font-size:14px;color:#dc2626;font-weight:500"></div>
        </div>
      </div>
    </div>
  </div>
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';
    import { getAuth, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, setPersistence, browserLocalPersistence, updateProfile, signOut } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';
    const firebaseConfig = {
      apiKey: "AIzaSyBmdB2Ut1XJkEShUrEqZYOBTUTPw8sxE-4",
      authDomain: "agroenglish-c9c18.firebaseapp.com",
      projectId: "agroenglish-c9c18",
      storageBucket: "agroenglish-c9c18.firebasestorage.app",
      messagingSenderId: "828217135226",
      appId: "1:828217135226:web:82f8c9d16657c4db1c2bc3"
    };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    setPersistence(auth, browserLocalPersistence).catch(()=>{});
    const gate = document.getElementById('auth-gate');
    const tabLogin = document.getElementById('gate-tab-login');
    const tabReg = document.getElementById('gate-tab-register');
    const vLogin = document.getElementById('gate-login');
    const vReg = document.getElementById('gate-register');
    const loginEmail = document.getElementById('gate-login-email');
    const loginPass = document.getElementById('gate-login-password');
    const loginBtn = document.getElementById('gate-login-submit');
    const loginMsg = document.getElementById('gate-login-msg');
    const regEmail = document.getElementById('gate-register-email');
    const regPass = document.getElementById('gate-register-password');
    const regBtn = document.getElementById('gate-register-submit');
    const regMsg = document.getElementById('gate-register-msg');
    const regName = document.getElementById('gate-register-name');
    function showToast(msg,type){ try { const el=document.createElement('div'); el.className='toast '+(type==='error'?'toast-error':'toast-success'); el.textContent=String(msg||''); document.body.appendChild(el); setTimeout(()=>{ el.classList.add('show') },10); setTimeout(()=>{ el.classList.remove('show'); setTimeout(()=>{ el.remove() },200) },2500); } catch {} }
    function show(v){ vLogin.style.display = v==='login' ? 'block' : 'none'; vReg.style.display = v==='register' ? 'block' : 'none'; }
    tabLogin.addEventListener('click', ()=>{ show('login'); tabLogin.style.background='#f5f5f5'; tabReg.style.background='#fff'; });
    tabReg.addEventListener('click', ()=>{ show('register'); tabReg.style.background='#f5f5f5'; tabLogin.style.background='#fff'; });
    function errMsg(el, code){ const map={ 'auth/invalid-credential':'E-mail ou senha inválidos.', 'auth/invalid-email':'E-mail inválido.', 'auth/user-not-found':'Usuário não encontrado.', 'auth/wrong-password':'Senha incorreta.', 'default':'Ocorreu um erro.' }; el.textContent = map[code] || map.default; }
    loginBtn.addEventListener('click', async (e)=>{ e.preventDefault(); loginMsg.textContent=''; loginBtn.disabled=true; try { await signInWithEmailAndPassword(auth, String(loginEmail.value||'').trim(), String(loginPass.value||'')); showToast('Login feito com sucesso','success'); } catch(err){ errMsg(loginMsg, String(err && err.code || 'default')); } loginBtn.disabled=false; });
    regBtn.addEventListener('click', async (e)=>{ e.preventDefault(); regMsg.textContent=''; regBtn.disabled=true; const name=String(regName.value||'').trim(); if (!name || name.length<2){ regMsg.textContent='Informe seu nome'; regBtn.disabled=false; try { regName.focus() } catch {} ; return; } try { await createUserWithEmailAndPassword(auth, String(regEmail.value||'').trim(), String(regPass.value||'')); if (auth.currentUser) { try { await updateProfile(auth.currentUser, { displayName: name }) } catch {} } showToast('Cadastro feito com sucesso','success'); } catch(err){ errMsg(regMsg, String(err && err.code || 'default')); } regBtn.disabled=false; });
    onAuthStateChanged(auth, (user)=>{
      if (user && user.uid) {
        const name = (user.displayName || (user.email||'').split('@')[0] || '').trim()
        try { localStorage.setItem('userName', name) } catch {}
        gate.style.display = 'none'
        try { window.dispatchEvent(new Event('hashchange')) } catch {}
      } else {
        gate.style.display = 'block'
      }
    });
    window.userSignOut = async function(){ try { await signOut(auth); gate.style.display='block'; } catch {} }
    window.getUserInfo = function(){ const u = auth.currentUser; return u ? { uid: u.uid, email: u.email||'', displayName: u.displayName||'' } : null }
    window.updateDisplayName = async function(name){ try { if (auth.currentUser) { await updateProfile(auth.currentUser, { displayName: String(name||'').trim() }); try { localStorage.setItem('userName', String(name||'').trim()) } catch {} } } catch {} }
  </script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="./src/slides/slides.js"></script>
  <script src="./src/exercises/exercises.js"></script>
  <script type="module" src="./main.js"></script>
  <noscript>Este aplicativo requer JavaScript.</noscript>
  <style>body{min-height:100vh}</style>
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./service-worker.js').catch(()=>{})
    } else {
      console.warn('Service Worker não suportado neste navegador.')
    }
  </script>
  </body>
</html>

